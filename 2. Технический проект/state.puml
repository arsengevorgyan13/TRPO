@startuml Диаграмма состояний
top to bottom direction
hide empty description
skinparam nodesep 70

state "Форма авторизации" as login
state "Дашборд администратора" as admin_dashboard
state "Дашборд диспетчера" as dispatcher_dashboard
state "Дашборд водителя" as driver_dashboard
state "Дашборд тех. персонала" as tech_dashboard

' Состояния администратора
state "Управление пользователями" as user_management
state "Регистрация пользователя" as user_registration
state "Ввод данных пользователя" as input_user_data
state "Проверка водительских данных" as check_driver_license
state "Редактирование пользователя" as edit_user
state "Удаление пользователя" as delete_user
' state "Подтверждение удаления" as confirm_deletion
state "Выгрузка отчетов" as export_reports
state "Выбор типа отчета" as select_report
state "Формирование отчета" as generate_report
state "Управление настройками аккаунта" as account_settings

' Состояния диспетчера
state "Управление задачами" as task_management
state "Создание задачи" as create_task
state "Редактирование задачи" as edit_task
state "Назначение задачи водителю" as assign_task
state "Просмотр задачи" as view_task
state "Управление маршрутами" as route_management
state "Создание маршрута" as create_route
state "Назначение маршрута" as assign_route
state "Управление расписанием" as schedule_management
state "Создание расписания" as create_schedule
state "Редактирование расписания" as edit_schedule
state "Закрепление автомобиля" as assign_vehicle
state "Просмотр карты" as view_map

' Состояния водителя
state "Мои задачи" as my_tasks
state "Начало выполнения задаче" as start_task
state "Выполнение задачи" as execute_task
state "Завершение задачи" as complete_task
state "Сообщение об инциденте" as report_incident
state "Мое расписание" as my_schedule
state "Просмотр расписания" as view_schedule
state "Маршрут на карте" as view_route_on_map
state "Добавление автомобиля" as add_vehicle
state "Ввод данных автомобиля" as input_vehicle_data
state "Проверка VIN" as check_vin
state "Ошибка добавления авто" as vehicle_error
state "Статус автомобиля" as vehicle_status

' Состояния тех. персонала
state "Техническое обслуживание" as maintenance
state "Планирование ТО" as plan_maintenance
state "Создание заявки ТО" as create_maintenance_request
state "Выполнение ТО" as perform_maintenance
state "Отметка о выполнении" as mark_completed
state "Списание автомобиля" as write_off_vehicle
state "Причина списания" as write_off_reason
state "Подтверждение списания" as confirm_write_off
state "История обслуживания" as maintenance_history

' Базовые переходы от авторизации
[*] --> login
login --> admin_dashboard : Администратор\nуспешная авторизация
login --> dispatcher_dashboard : Диспетчер\nуспешная авторизация
login --> driver_dashboard : Водитель\nуспешная авторизация
login --> tech_dashboard : Тех. персонал\nуспешная авторизация

' Переходы администратора
admin_dashboard --> user_management : Нажал "Управление пользователями"
admin_dashboard --> export_reports : Нажал "Отчеты"
admin_dashboard --> account_settings : Нажал "Настройки"

user_management --> user_registration : Нажал "Добавить пользователя"
user_management --> edit_user : Выбрал пользователя → "Редактировать"
user_management --> delete_user : Выбрал пользователя → "Удалить"

edit_user --> input_user_data : Редактирование данных пользователя

user_registration --> input_user_data : Начало регистрации
input_user_data --> check_driver_license : Роль = Водитель
check_driver_license --> input_user_data : ВУ просрочено
check_driver_license --> user_management : ВУ валидно, пользователь создан
input_user_data --> user_management : Роль != Водитель, пользователь создан

delete_user --> user_management : Подтверждение удаления

export_reports --> select_report : Выбор типа отчета
select_report --> generate_report : Нажал "Сформировать"
generate_report --> export_reports : Отчет готов

account_settings --> admin_dashboard : Настройки сохранены

' Переходы диспетчера
dispatcher_dashboard --> task_management : Нажал "Задачи"
dispatcher_dashboard --> route_management : Нажал "Маршруты"
dispatcher_dashboard --> schedule_management : Нажал "Расписание"
dispatcher_dashboard --> view_map : Нажал "Карта"

task_management --> create_task : Нажал "Создать задачу"
task_management --> edit_task : Выбрал задачу → "Редактировать"
task_management --> assign_task : Выбрал задачу → "Назначить"
task_management --> view_task : Выбрал задачу → "Просмотреть"

create_task --> task_management : Задача создана
edit_task --> task_management : Изменения сохранены
assign_task --> task_management : Задача назначена

route_management --> create_route : Нажал "Создать маршрут"
create_route --> assign_route: Введены точки маршрута
assign_route --> route_management : Маршрут назначен

schedule_management --> create_schedule : Нажал "Создать расписание"
create_schedule --> edit_schedule : Базовое расписание создано
edit_schedule --> assign_vehicle : Расписание настроено
assign_vehicle --> schedule_management : Автомобиль закреплен


' Переходы водителя
driver_dashboard --> my_tasks : Нажал "Мои задачи"
driver_dashboard --> my_schedule : Нажал "Мое расписание"
driver_dashboard --> add_vehicle : Нажал "Добавить авто"
driver_dashboard --> view_route_on_map : Нажал "Текущий маршрут"

my_tasks --> start_task : Выбрал задачу → "Начать"
my_tasks --> report_incident : Нажал "Сообщить об инциденте"

start_task --> execute_task : Задача начата
execute_task --> complete_task : Нажал "Завершить"
complete_task --> my_tasks : Задача завершена
report_incident --> my_tasks : Инцидент зарегистрирован

my_schedule --> view_schedule : Автоматический переход

add_vehicle --> input_vehicle_data : Начало добавления
input_vehicle_data --> check_vin : Введены данные авто
check_vin --> vehicle_error : VIN не прошел проверку
check_vin --> vehicle_status : VIN валиден, авто добавлено
vehicle_status --> driver_dashboard : Нажал "Готово"
vehicle_error --> add_vehicle : Нажал "Повторить"

' Переходы тех. персонала
tech_dashboard --> maintenance : Нажал "Тех. обслуживание"
tech_dashboard --> write_off_vehicle : Нажал "Списание авто"

maintenance --> plan_maintenance : Нажал "Запланировать ТО"
plan_maintenance --> create_maintenance_request : Выбрал авто и дату
create_maintenance_request --> perform_maintenance : Заявка создана
perform_maintenance --> mark_completed : ТО выполнено
mark_completed --> maintenance : Отмечено как выполненное
maintenance --> maintenance_history : Нажал "История"

write_off_vehicle --> write_off_reason : Выбор автомобиля
write_off_reason --> confirm_write_off : Указана причина
confirm_write_off --> tech_dashboard : Автомобиль списан\n(не подлежит починке)

' Общие переходы возврата
user_management --> admin_dashboard : Нажал "Назад"
export_reports --> admin_dashboard : Нажал "Назад"
account_settings --> admin_dashboard : Нажал "Назад"
edit_user --> user_management : Нажал "Назад"
input_user_data --> user_management : Нажал "Назад"
delete_user --> user_management : Нажал "Назад"
select_report --> export_reports : Нажал "Назад"

task_management --> dispatcher_dashboard : Нажал "Назад"
route_management --> dispatcher_dashboard : Нажал "Назад"
schedule_management --> dispatcher_dashboard : Нажал "Назад"
create_task --> task_management : Нажал "Назад"
edit_task --> task_management : Нажал "Назад"
view_task --> task_management : Нажал "Назад"
create_route --> route_management : Нажал "Назад"
create_schedule --> schedule_management : Нажал "Назад"
view_map --> dispatcher_dashboard : Нажал "Назад"

my_tasks --> driver_dashboard : Нажал "Назад"
my_schedule --> driver_dashboard : Нажал "Назад"
add_vehicle --> driver_dashboard : Нажал "Отмена"
view_schedule --> driver_dashboard : Нажал "Назад"
view_route_on_map --> driver_dashboard : Нажал "Назад"

maintenance --> tech_dashboard : Нажал "Назад"
write_off_vehicle --> tech_dashboard : Нажал "Отмена"
plan_maintenance --> maintenance : Нажал "Назад"
create_maintenance_request --> maintenance : Нажал "Назад"
maintenance_history --> maintenance : Нажал "Назад"

' Возврат на дашборд при разлогине
admin_dashboard --> login : Выход из системы
dispatcher_dashboard --> login : Выход из системы
driver_dashboard --> login : Выход из системы
tech_dashboard --> login : Выход из системы
@enduml